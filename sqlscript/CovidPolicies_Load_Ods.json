{
	"name": "CovidPolicies_Load_Ods",
	"properties": {
		"content": {
			"query": "SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROC [stg].[CovidPolicies_Load_Ods] AS\nIF OBJECT_ID(N'tempdb..##TEMP_CovidPolicies') IS NOT NULL\nBEGIN\n\tDROP TABLE #TEMP_CovidPolicies\nEND\n\nSELECT *\nINTO #TEMP_CovidPolicies\nFROM ( SELECT \t\t \n\t[CountryName] ,\n\t[CountryCode] ,\n\t[RegionName] ,\n\t[RegionCode] ,\n\t[Jurisdiction] ,\n\t[Date] ,\n\t[C1_School closing] ,\n\t[C1_Flag] ,\n\t[C2_Workplace closing] ,\n\t[C2_Flag] ,\n\t[C3_Cancel public events],\n\t[C3_Flag] ,\n\t[C4_Restrictions on gatherings] ,\n\t[C4_Flag] ,\n\t[C5_Close public transport] ,\n\t[C5_Flag] ,\n\t[C6_Stay at home requirements] ,\n\t[C6_Flag] ,\n\t[C7_Restrictions on internal movement] ,\n\t[C7_Flag] ,\n\t[C8_International travel controls] ,\n\t[E1_Income support] ,\n\t[E1_Flag] ,\n\t[E2_Debt contract relief] ,\n\t[E3_Fiscal measures] ,\n\t[E4_International support] ,\n\t[H1_Public information campaigns] ,\n\t[H1_Flag] ,\n\t[H2_Testing policy] ,\n\t[H3_Contact tracing] ,\n\t[H4_Emergency investment in healthcare] ,\n\t[H5_Investment in vaccines] ,\n\t[H6_Facial Coverings] ,\n\t[H6_Flag] ,\n\t[H7_Vaccination policy] ,\n\t[H7_Flag] ,\n\t[H8_Protection of elderly people] ,\n\t[H8_Flag] ,\n\t[M1_Wildcard] ,\n\t[StringencyIndex] ,\n\t[StringencyIndexForDisplay] ,\n\t[StringencyLegacyIndex] ,\n\t[CStringencyLegacyIndexForDisplay] ,\n\t[GovernmentResponseIndex] ,\n\t[GovernmentResponseIndexForDisplay] ,\n\t[ContainmentHealthIndex] ,\n\t[ContainmentHealthIndexForDisplay] ,\n\t[EconomicSupportIndex] ,\n\t[EconomicSupportIndexForDisplay] ,\n\t'AzureCosmos' as [SrcName] \n\tFROM stg.Cosmos_CovidPolicy_Stg where [RegionCode] is null \n\t) AS A\n\n    delete from #TEMP_CovidPolicies where [RegionCode] is not null \n\nUPDATE tgt\nSET \ttgt.[Jurisdiction] = src.[Jurisdiction] ,\n\ttgt.[Date] =convert(date,src.[Date]),\n\ttgt.[C1_School closing] = CONVERT(bigint, src.[C1_School closing]) ,\n\ttgt.[C1_Flag] =src.[C1_Flag],\n\ttgt.[C2_Workplace closing] = convert(bigint, src.[C2_Workplace closing]) ,\n\ttgt.[C2_Flag] =  src.[C2_Flag],\n\ttgt.[C3_Cancel public events] = convert(bigint, src.[C3_Cancel public events]),\n\ttgt.[C3_Flag] = src.[C3_Flag] ,\n\ttgt.[C4_Restrictions on gatherings] = convert(bigint,src.[C4_Restrictions on gatherings]),\n\ttgt.[C4_Flag] = src.[C4_Flag] ,\n\ttgt.[C5_Close public transport] = convert(bigint,src.[C5_Close public transport]),\n\ttgt.[C5_Flag]= src.[C5_Flag] ,\n\ttgt.[C6_Stay at home requirements] = convert(bigint,src.[C6_Stay at home requirements]) ,\n\ttgt.[C6_Flag] = src.[C6_Flag]  ,\n\ttgt.[C7_Restrictions on internal movement] = convert(bigint,src.[C7_Restrictions on internal movement]) ,\n\ttgt.[C7_Flag] = src.[C7_Flag] ,\n\ttgt.[C8_International travel controls] = convert(bigint,src.[C8_International travel controls]) ,\n\ttgt.[E1_Income support] = convert(bigint,src.[E1_Income support]) ,\n\ttgt.[E1_Flag]=src.[E1_Flag] ,\n\ttgt.[E2_Debt contract relief]=convert(bigint,src.[E2_Debt contract relief]) ,\n\ttgt.[E3_Fiscal measures] =convert(float,src.[E3_Fiscal measures]),\n\ttgt.[E4_International support]=convert(float,src.[E4_International support] ),\n\ttgt.[H1_Public information campaigns]= convert(bigint,src.[H1_Public information campaigns]) ,\n\ttgt.[H1_Flag] = src.[H1_Flag] ,\n\ttgt.[H2_Testing policy] = convert(bigint,src.[H2_Testing policy]) ,\n\ttgt.[H3_Contact tracing] = convert(bigint,src.[H3_Contact tracing] ),\n\ttgt.[H4_Emergency investment in healthcare] = convert(float,src.[H4_Emergency investment in healthcare]) ,\n\ttgt.[H5_Investment in vaccines] = convert(float,src.[H5_Investment in vaccines]) ,\n\ttgt.[H6_Facial Coverings] = convert(bigint,src.[H6_Facial Coverings]) ,\n\ttgt.[H6_Flag] = src.[H6_Flag] ,\n\ttgt.[H7_Vaccination policy]=convert(bigint,src.[H7_Vaccination policy])  ,\n\ttgt.[H7_Flag] = src.[H7_Flag],\n\ttgt.[H8_Protection of elderly people] = \tconvert(bigint,src.[H8_Protection of elderly people]) ,\n\ttgt.[H8_Flag] = src.[H8_Flag],\n\ttgt.[M1_Wildcard] = convert(int,src.[M1_Wildcard]) ,\n\ttgt.[StringencyIndex]= convert(float,\tsrc.[StringencyIndex])  ,\n\ttgt.[StringencyIndexForDisplay] = convert(float,src.[StringencyIndexForDisplay]),\n\ttgt.[StringencyLegacyIndex] = convert(float,src.[StringencyLegacyIndex] ),\n\ttgt.[CStringencyLegacyIndexForDisplay] = convert(float,src.[CStringencyLegacyIndexForDisplay]) ,\n\ttgt.[GovernmentResponseIndex] = convert(float,src.[GovernmentResponseIndex]),\n\ttgt.[GovernmentResponseIndexForDisplay] = convert(float,src.[GovernmentResponseIndexForDisplay]) ,\n\ttgt.[ContainmentHealthIndex] =convert(float,src.[ContainmentHealthIndex])  ,\n\ttgt.[ContainmentHealthIndexForDisplay] = convert(float,src.[ContainmentHealthIndexForDisplay]),\n\ttgt.[EconomicSupportIndex] = convert(float,src.[EconomicSupportIndex]),\n\ttgt.[EconomicSupportIndexForDisplay] = convert(float,src.[EconomicSupportIndexForDisplay] ) ,\n\ttgt.updated_date = getdate()\nFROM ods.CovidPolicies tgt\nINNER JOIN #TEMP_CovidPolicies src ON tgt.[CountryCode] = src.[CountryCode]\n\tAND  convert(date,tgt.[Date])  = convert(date,src.[Date]) \n\nINSERT INTO ods.CovidPolicies  (\n\t\t[CountryName] ,\n\t[CountryCode] ,\n\t[RegionName] ,\n\t[RegionCode] ,\n\t[Jurisdiction] ,\n\t[Date] ,\n\t[C1_School closing] ,\n\t[C1_Flag] ,\n\t[C2_Workplace closing] ,\n\t[C2_Flag] ,\n\t[C3_Cancel public events],\n\t[C3_Flag] ,\n\t[C4_Restrictions on gatherings] ,\n\t[C4_Flag] ,\n\t[C5_Close public transport] ,\n\t[C5_Flag] ,\n\t[C6_Stay at home requirements] ,\n\t[C6_Flag] ,\n\t[C7_Restrictions on internal movement] ,\n\t[C7_Flag] ,\n\t[C8_International travel controls] ,\n\t[E1_Income support] ,\n\t[E1_Flag] ,\n\t[E2_Debt contract relief] ,\n\t[E3_Fiscal measures] ,\n\t[E4_International support] ,\n\t[H1_Public information campaigns] ,\n\t[H1_Flag] ,\n\t[H2_Testing policy] ,\n\t[H3_Contact tracing] ,\n\t[H4_Emergency investment in healthcare] ,\n\t[H5_Investment in vaccines] ,\n\t[H6_Facial Coverings] ,\n\t[H6_Flag] ,\n\t[H7_Vaccination policy] ,\n\t[H7_Flag] ,\n\t[H8_Protection of elderly people] ,\n\t[H8_Flag] ,\n\t[M1_Wildcard] ,\n\t[StringencyIndex] ,\n\t[StringencyIndexForDisplay] ,\n\t[StringencyLegacyIndex] ,\n\t[CStringencyLegacyIndexForDisplay] ,\n\t[GovernmentResponseIndex] ,\n\t[GovernmentResponseIndexForDisplay] ,\n\t[ContainmentHealthIndex] ,\n\t[ContainmentHealthIndexForDisplay] ,\n\t[EconomicSupportIndex] ,\n\t[EconomicSupportIndexForDisplay] ,\n\t [SrcName] \n\t, createD_date \n\t)\nSELECT src.[CountryName] ,\n\tsrc.[CountryCode] ,\n\tsrc.[RegionName] ,\n\tsrc.[RegionCode] ,\n\tsrc.[Jurisdiction] ,\n\tconvert(date, src.[Date]) as [date] ,\n\tconvert(int,src.[C1_School closing] ) as [C1_School closing],\n\tsrc.[C1_Flag] ,\n\tconvert(int,src.[C2_Workplace closing] ) as [C2_Workplace closing],\n\tsrc.[C2_Flag] ,\n\tconvert(int,src.[C3_Cancel public events]) as [C3_Cancel public events],\n\tsrc.[C3_Flag] ,\n\tconvert(int,src.[C4_Restrictions on gatherings]) as [C4_Restrictions on gatherings] ,\n\tsrc.[C4_Flag] ,\n\tconvert(int,src.[C5_Close public transport]) as [C5_Close public transport] ,\n\tsrc.[C5_Flag] ,\n\tconvert(int,src.[C6_Stay at home requirements] ) as [C6_Stay at home requirements],\n\tsrc.[C6_Flag] ,\n\tconvert(int,src.[C7_Restrictions on internal movement]) as [C7_Restrictions on internal movement] ,\n\tconvert(bit,src.[C7_Flag] ) as [C7_Flag],\n\tconvert(int,src.[C8_International travel controls]) as [C8_International travel controls],\n    convert(int, src.[E1_Income support] ) as [E1_Income support] ,\n\tconvert(bit,src.[E1_Flag]) as [E1_Flag],\n\tconvert(int,src.[E2_Debt contract relief] ) as [E2_Debt contract relief],\n\tconvert(float,src.[E3_Fiscal measures]) as [E3_Fiscal measures],\n\tconvert(float,src.[E4_International support] ) as [E4_International support],\n\tconvert(int,src.[H1_Public information campaigns]) as [H1_Public information campaigns],\n\tsrc.[H1_Flag] ,\n\tconvert(int,src.[H2_Testing policy] ) as [H2_Testing policy] ,\n\tconvert(int,src.[H3_Contact tracing] ) as [H3_Contact tracing],\n\tconvert(float,src.[H4_Emergency investment in healthcare] ) as [H4_Emergency investment in healthcare],\n\tconvert(float,src.[H5_Investment in vaccines]) as [H5_Investment in vaccines] ,\n\tconvert(int,src.[H6_Facial Coverings] ) as [H6_Facial Coverings],\n\tsrc.[H6_Flag] ,\n\tconvert(int,src.[H7_Vaccination policy] ) as [H7_Vaccination policy] ,\n\tsrc.[H7_Flag] ,\n\tconvert(int,src.[H8_Protection of elderly people]) as [H8_Protection of elderly people] ,\n\tsrc.[H8_Flag] ,\n\tconvert(float,src.[M1_Wildcard] )as [M1_Wildcard] ,\n\tconvert(float,src.[StringencyIndex]) as [StringencyIndex],\n\tconvert(float,src.[StringencyIndexForDisplay] ) as [StringencyIndexForDisplay],\n\tconvert(float,src.[StringencyLegacyIndex] )as [StringencyLegacyIndex],\n\tconvert(float,src.[CStringencyLegacyIndexForDisplay]) as [CStringencyLegacyIndexForDisplay],\n\tconvert(float,src.[GovernmentResponseIndex] )as [GovernmentResponseIndex],\n\tconvert(float,src.[GovernmentResponseIndexForDisplay] )as [GovernmentResponseIndexForDisplay],\n\tconvert(float,src.[ContainmentHealthIndex] ) as [ContainmentHealthIndex] ,\n\tconvert(float,src.[ContainmentHealthIndexForDisplay])as [ContainmentHealthIndexForDisplay],\n\tconvert(float,src.[EconomicSupportIndex])as [EconomicSupportIndex] ,\n\tconvert(float,src.[EconomicSupportIndexForDisplay])as [EconomicSupportIndexForDisplay] ,\n\t'AzureCosmos' as [SrcName] \n\t,GETDATE() AS created_date\nFROM #TEMP_CovidPolicies SRC\nLEFT JOIN ods.CovidPolicies TGT ON tgt.[CountryCode] = src.[CountryCode]\n\tAND tgt.[RegionCode] = src.[RegionCode] and convert(date,tgt.[Date]) = convert(date,src.[Date])\nWHERE tgt.[CountryCode] IS NULL\n\tand tgt.[Date] IS NULL \nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "covid19dwsqlpool",
				"poolName": "covid19dwsqlpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}