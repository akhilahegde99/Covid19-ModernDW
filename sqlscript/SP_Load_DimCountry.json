{
	"name": "SP_Load_DimCountry",
	"properties": {
		"content": {
			"query": "SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROC [dwh].[Load_DimCountry] AS\nIF OBJECT_ID(N'tempdb..##TEMP_DimCOUNTRY') IS NOT NULL\nBEGIN\n\tDROP TABLE #TEMP_DimCOUNTRY\nEND\n\nSELECT *\nINTO #TEMP_DimCOUNTRY\nFROM (\n\tSELECT distinct [CountryName]\n\t\t,[CountryCode]\n\t\t,[Longitude]\n\t\t,[Latitude]\n\tFROM ods.country\t\n\t) AS A\n\nUPDATE tgt\nSET tgt.[Longitude] = src.[Longitude]\n\t,tgt.[Latitude] = src.[Latitude]\n\t,tgt.updated_date = getdate()\nFROM dwh.DimCountry tgt\nINNER JOIN #TEMP_DimCOUNTRY src ON tgt.[CountryName] = replace(src.[CountryName], '\"', '')\n\tAND tgt.[CountryCode] = replace(src.[CountryCode], '\"', '')\n\nINSERT INTO dwh.DimCountry  (\n\t[CountryName]\n\t,[CountryCode]\n\t,[Longitude]\n\t,[Latitude]\n\t,createD_date\n\t)\nSELECT REPLACE(src.[CountryName], '\"', '') AS [CountryName]\n\t,REPLACE(src.[CountryCode], '\"', '') AS [CountryCode]\n\t,src.[Longitude]\n\t,src.[Latitude]\n\t,GETDATE() AS create_date\nFROM #TEMP_DimCOUNTRY SRC\nLEFT JOIN dwh.DimCountry TGT ON tgt.[CountryName] = replace(src.[CountryName], '\"', '')\n\tAND tgt.[CountryCode] = replace(src.[CountryCode], '\"', '')\nWHERE TGT.[CountryName] IS NULL\n\tAND TGT.[CountryCode] IS NULL\nGO",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "covid19dwsqlpool",
				"poolName": "covid19dwsqlpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}