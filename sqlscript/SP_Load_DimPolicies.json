{
	"name": "SP_Load_DimPolicies",
	"properties": {
		"content": {
			"query": "/****** Object:  StoredProcedure [stg].[CovidPolicies_Load_Ods]    Script Date: 04-05-2023 22:42:48 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROC [dwh].[Load_DimPolicies] AS\nIF OBJECT_ID(N'tempdb..##Temp_DimPolicies') IS NOT NULL\nBEGIN\n\tDROP TABLE #Temp_DimPolicies\nEND\n\nSELECT *\nINTO #Temp_DimPolicies\nFROM ( SELECT \t\t \n\tDC.[CountryKey] ,\n\tdd.[DateKey] ,\n\t[Jurisdiction] ,\n\t[C1_School closing] ,\n\t[C1_Flag] ,\n\t[C2_Workplace closing] ,\n\t[C2_Flag] ,\n\t[C3_Cancel public events],\n\t[C3_Flag] ,\n\t[C4_Restrictions on gatherings] ,\n\t[C4_Flag] ,\n\t[C5_Close public transport] ,\n\t[C5_Flag] ,\n\t[C6_Stay at home requirements] ,\n\t[C6_Flag] ,\n\t[C7_Restrictions on internal movement] ,\n\t[C7_Flag] ,\n\t[C8_International travel controls] ,\n\t[E1_Income support] ,\n\t[E1_Flag] ,\n\t[E2_Debt contract relief] ,\n\t[E3_Fiscal measures] ,\n\t[E4_International support] ,\n\t[H1_Public information campaigns] ,\n\t[H1_Flag] ,\n\t[H2_Testing policy] ,\n\t[H3_Contact tracing] ,\n\t[H4_Emergency investment in healthcare] ,\n\t[H5_Investment in vaccines] ,\n\t[H6_Facial Coverings] ,\n\t[H6_Flag] ,\n\t[H7_Vaccination policy] ,\n\t[H7_Flag] ,\n\t[H8_Protection of elderly people] ,\n\t[H8_Flag] ,\n\t[M1_Wildcard] ,\n\t[StringencyIndex] ,\n\t[StringencyIndexForDisplay] ,\n\t[StringencyLegacyIndex] ,\n\t[CStringencyLegacyIndexForDisplay] ,\n\t[GovernmentResponseIndex] ,\n\t[GovernmentResponseIndexForDisplay] ,\n\t[ContainmentHealthIndex] ,\n\t[ContainmentHealthIndexForDisplay] ,\n\t[EconomicSupportIndex] ,\n\t[EconomicSupportIndexForDisplay]\n\tFROM ods.CovidPolicies CP  \n\tinner join dwh.DimCountry DC ON DC.CountryCode = CP.CountryCode\n\tINNER JOIN dwh.DimDate dd ON CONVERT(INT, CONVERT(VARCHAR(8), CP.Date, 112)) = dd.datekey\n\t) AS A\n\n   \n\nUPDATE tgt\nSET \ttgt.[Jurisdiction] = src.[Jurisdiction] ,\n\ttgt.[C1_School closing] =  src.[C1_School closing] ,\n\ttgt.[C1_Flag] =src.[C1_Flag],\n\ttgt.[C2_Workplace closing] = src.[C2_Workplace closing] ,\n\ttgt.[C2_Flag] =  src.[C2_Flag],\n\ttgt.[C3_Cancel public events] = src.[C3_Cancel public events],\n\ttgt.[C3_Flag] = src.[C3_Flag] ,\n\ttgt.[C4_Restrictions on gatherings] = src.[C4_Restrictions on gatherings],\n\ttgt.[C4_Flag] = src.[C4_Flag] ,\n\ttgt.[C5_Close public transport] = src.[C5_Close public transport],\n\ttgt.[C5_Flag]= src.[C5_Flag] ,\n\ttgt.[C6_Stay at home requirements] = src.[C6_Stay at home requirements] ,\n\ttgt.[C6_Flag] = src.[C6_Flag]  ,\n\ttgt.[C7_Restrictions on internal movement] = src.[C7_Restrictions on internal movement] ,\n\ttgt.[C7_Flag] = src.[C7_Flag] ,\n\ttgt.[C8_International travel controls] = src.[C8_International travel controls] ,\n\ttgt.[E1_Income support] = src.[E1_Income support] ,\n\ttgt.[E1_Flag]=src.[E1_Flag] ,\n\ttgt.[E2_Debt contract relief]=src.[E2_Debt contract relief] ,\n\ttgt.[E3_Fiscal measures] =src.[E3_Fiscal measures],\n\ttgt.[E4_International support]=src.[E4_International support] ,\n\ttgt.[H1_Public information campaigns]= src.[H1_Public information campaigns] ,\n\ttgt.[H1_Flag] = src.[H1_Flag] ,\n\ttgt.[H2_Testing policy] = src.[H2_Testing policy] ,\n\ttgt.[H3_Contact tracing] = src.[H3_Contact tracing] ,\n\ttgt.[H4_Emergency investment in healthcare] = src.[H4_Emergency investment in healthcare] ,\n\ttgt.[H5_Investment in vaccines] = src.[H5_Investment in vaccines] ,\n\ttgt.[H6_Facial Coverings] = src.[H6_Facial Coverings] ,\n\ttgt.[H6_Flag] = src.[H6_Flag] ,\n\ttgt.[H7_Vaccination policy]=src.[H7_Vaccination policy]  ,\n\ttgt.[H7_Flag] = src.[H7_Flag],\n\ttgt.[H8_Protection of elderly people] = \tsdrc.[H8_Protection of elderly people] ,\n\ttgt.[H8_Flag] = src.[H8_Flag],\n\ttgt.[M1_Wildcard] = src.[M1_Wildcard] ,\n\ttgt.[StringencyIndex]= \tsrc.[StringencyIndex]  ,\n\ttgt.[StringencyIndexForDisplay] = src.[StringencyIndexForDisplay],\n\ttgt.[StringencyLegacyIndex] = src.[StringencyLegacyIndex] ,\n\ttgt.[CStringencyLegacyIndexForDisplay] = src.[CStringencyLegacyIndexForDisplay] ,\n\ttgt.[GovernmentResponseIndex] = src.[GovernmentResponseIndex],\n\ttgt.[GovernmentResponseIndexForDisplay] = src.[GovernmentResponseIndexForDisplay] ,\n\ttgt.[ContainmentHealthIndex] =src.[ContainmentHealthIndex]  ,\n\ttgt.[ContainmentHealthIndexForDisplay] = src.[ContainmentHealthIndexForDisplay],\n\ttgt.[EconomicSupportIndex] = src.[EconomicSupportIndex],\n\ttgt.[EconomicSupportIndexForDisplay] = src.[EconomicSupportIndexForDisplay]  ,\n\ttgt.updated_date = getdate()\nFROM ods.CovidPolicies tgt\nINNER JOIN #Temp_DimPolicies src ON tgt.[CountryKey] = src.[CountryCode]\n\tAND  CONVERT(INT, CONVERT(VARCHAR(8), tgt.Date, 112)) = src.datekey\n\nINSERT INTO ods.CovidPolicies  (\n\t\tDC.[CountryKey] ,\n\t[DateKey],\n\t[Jurisdiction] ,\n\t[C1_School closing] ,\n\t[C1_Flag] ,\n\t[C2_Workplace closing] ,\n\t[C2_Flag] ,\n\t[C3_Cancel public events],\n\t[C3_Flag] ,\n\t[C4_Restrictions on gatherings] ,\n\t[C4_Flag] ,\n\t[C5_Close public transport] ,\n\t[C5_Flag] ,\n\t[C6_Stay at home requirements] ,\n\t[C6_Flag] ,\n\t[C7_Restrictions on internal movement] ,\n\t[C7_Flag] ,\n\t[C8_International travel controls] ,\n\t[E1_Income support] ,\n\t[E1_Flag] ,\n\t[E2_Debt contract relief] ,\n\t[E3_Fiscal measures] ,\n\t[E4_International support] ,\n\t[H1_Public information campaigns] ,\n\t[H1_Flag] ,\n\t[H2_Testing policy] ,\n\t[H3_Contact tracing] ,\n\t[H4_Emergency investment in healthcare] ,\n\t[H5_Investment in vaccines] ,\n\t[H6_Facial Coverings] ,\n\t[H6_Flag] ,\n\t[H7_Vaccination policy] ,\n\t[H7_Flag] ,\n\t[H8_Protection of elderly people] ,\n\t[H8_Flag] ,\n\t[M1_Wildcard] ,\n\t[StringencyIndex] ,\n\t[StringencyIndexForDisplay] ,\n\t[StringencyLegacyIndex] ,\n\t[CStringencyLegacyIndexForDisplay] ,\n\t[GovernmentResponseIndex] ,\n\t[GovernmentResponseIndexForDisplay] ,\n\t[ContainmentHealthIndex] ,\n\t[ContainmentHealthIndexForDisplay] ,\n\t[EconomicSupportIndex] ,\n\t[EconomicSupportIndexForDisplay] ,\n\t createD_date \n\t)\nSELECT DC.[CountryKey] ,\n\tDD.[DateKey],\n\tSRC.[Jurisdiction],\n\tsrc.[C1_School closing]  as [C1_School closing],\n\tsrc.[C1_Flag] ,\n\tsrc.[C2_Workplace closing] as [C2_Workplace closing],\n\tsrc.[C2_Flag] ,\n\tsrc.[C3_Cancel public events] as [C3_Cancel public events],\n\tsrc.[C3_Flag] ,\n\tsrc.[C4_Restrictions on gatherings] as [C4_Restrictions on gatherings] ,\n\tsrc.[C4_Flag] ,\n\tsrc.[C5_Close public transport] as [C5_Close public transport] ,\n\tsrc.[C5_Flag] ,\n\tsrc.[C6_Stay at home requirements]  as [C6_Stay at home requirements],\n\t[C6_Flag] ,\n\t[C7_Restrictions on internal movement] as [C7_Restrictions on internal movement] ,\n\t[C7_Flag]  as [C7_Flag],\n\t[C8_International travel controls] as [C8_International travel controls],\n    [E1_Income support] as [E1_Income support] ,\n\t[E1_Flag] as [E1_Flag],\n\t[E2_Debt contract relief]  as [E2_Debt contract relief],\n\t[E3_Fiscal measures] as [E3_Fiscal measures],\n\t[E4_International support]  as [E4_International support],\n\t[H1_Public information campaigns] as [H1_Public information campaigns],\n\t[H1_Flag] ,\n\t[H2_Testing policy]  as [H2_Testing policy] ,\n\t[H3_Contact tracing]  as [H3_Contact tracing],\n\t[H4_Emergency investment in healthcare]  as [H4_Emergency investment in healthcare],\n\t[H5_Investment in vaccines] as [H5_Investment in vaccines] ,\n\t[H6_Facial Coverings]  as [H6_Facial Coverings],\n\t[H6_Flag] ,\n\t[H7_Vaccination policy]  as [H7_Vaccination policy] ,\n\t[H7_Flag] ,\n\tsrc.[H8_Protection of elderly people] as [H8_Protection of elderly people] ,\n\tsrc.[H8_Flag] ,\n\t[M1_Wildcard] as [M1_Wildcard] ,\n\t[StringencyIndex] as [StringencyIndex],\n\t[StringencyIndexForDisplay]  as [StringencyIndexForDisplay],\n\t[StringencyLegacyIndex] as [StringencyLegacyIndex],\n\t[CStringencyLegacyIndexForDisplay] as [CStringencyLegacyIndexForDisplay],\n\t[GovernmentResponseIndex] as [GovernmentResponseIndex],\n\t[GovernmentResponseIndexForDisplay] as [GovernmentResponseIndexForDisplay],\n\t[ContainmentHealthIndex]  as [ContainmentHealthIndex] ,\n\t[ContainmentHealthIndexForDisplay] as [ContainmentHealthIndexForDisplay],\n\t[EconomicSupportIndex] as [EconomicSupportIndex] ,\n\t[EconomicSupportIndexForDisplay] as [EconomicSupportIndexForDisplay] ,\n\tGETDATE() AS created_date\nFROM #Temp_DimPolicies SRC\nLEFT JOIN ods.CovidPolicies TGT ON tgt.[CountrykEY] = src.[CountryKEY]\n\tand TGT.DATEKEY = SRC.DATEKEY\nWHERE tgt.DATEKEY IS NULL\n\tand tgt.DATEKEY IS NULL\nGO\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "covid19dwsqlpool",
				"poolName": "covid19dwsqlpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}